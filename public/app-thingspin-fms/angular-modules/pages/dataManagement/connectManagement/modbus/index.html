
<div class="modbus-conn-editor">
    <div>
        <div class="modbus-title-top">Modbus 추가 양식</div>
        <div class="modbus-right-button-area">
            <button id="modbus-cancel-btn" className="btn" ng-click="ctrl.close()">
                취소
            </button>    
            <button id="modbus-save-btn" className="btn" ng-click="ctrl.checkParams()">
                저장
            </button>
        </div>
    </div>

    <div class="section gf-form-group" id="main-view">
            <div class = "modbus-edit-box">
                <div class="modbus-title-conn">
                Modbus 접속 정보
                </div> 
                <div class="modbus-conn-test-buttons">
                    <button class="ts-btn ts-btn-save {{ctrl.connectStatus}}" ng-click="ctrl.connTest()"><i class="tsi {{ctrl.connectIcon}}"></i></button>
                </div>
            </div>

            <div class="modbus-conn-section-line"></div>

            <div class = "modbus-edit-box">
              
                    <span class="modbus-subtitle" id="modbus-collector">수집기 이름</span>
                    <div class="modbus-edit-bg" id="modbus-collector-name-position">
                        <input id="modbus-edit" type="text" class="gf-form-input" ng-model="ctrl.connName" placeholder="수집기 이름">
                    </div>
                
                
                    <span class="modbus-subtitle" id="modbus-host">Host</span>
                    <div class="modbus-edit-bg" id="modbus-collector-host-position">
                        <input id="modbus-edit" type="text" class="gf-form-input"   ng-model="ctrl.modbusHost" placeholder="127.0.0.1" >
                    </div>
                
                
                    <span class="modbus-subtitle" id="modbus-port">Port</span>
                    <div class="modbus-edit-bg" id="modbus-collector-port-position">
                        <input id="modbus-edit" type="text" class="gf-form-input"   ng-model="ctrl.modbusPort" placeholder="502" >
                    </div>
                
            </div>   
            
        <!--추가정보 -->
        <div class="modbus-title-conn-add">
            Modbus 추가 정보
        </div>
        <div class="modbus-conn-section-line"></div>
        <div class="modbus-edit-box">
            <span class="modbus-subtitle" id="modbus-unit-id">Unit-id</span>
            <div class="modbus-unitid-bg" id="modbus-unit-id-pos">
                <input id="modbus-edit" type="number" class="gf-form-input" ng-model="ctrl.modbusUnitID" placeholder="1">
            </div>

            <span class="modbus-subtitle" id="modbus-time-out">Time out (ms)</span>
            <div class="modbus-timeout-bg" id="modbus-time-out-pos">
                <input id="modbus-edit" type="number" class="gf-form-input" ng-model="ctrl.modbusTimeOut" placeholder="1000">
            </div>
                    
            <span class="modbus-subtitle" id="modbus-Reconnect">Reconnect (ms)</span>
            <div class="modbus-reconnect-bg" id="modbus-Reconnect-pos">
                <input id="modbus-edit" type="number" class="gf-form-input" ng-model="ctrl.modbusReTimeOut" placeholder="2000">
            </div>

            <span class="modbus-subtitle" id="modbus-Intervals">Read Intervals (sec)</span>
            <div class="modbus-interval-bg" id="modbus-Intervals-pos">
                <input id="modbus-edit" type="number" class="gf-form-input" ng-model="ctrl.modbusReadIntervals" placeholder="1">
            </div>
        </div>
        <!-- address list-->    
        <div class="modbus-edit-box">
            <div class="modbus-title-addr-list">수집 Address list</div>
            <button id="modbus-addr-add-btn" className="btn" ng-click="ctrl.onShowAddressEditView()" ng-show="ctrl.isAddressEditBtn">+ Address</button>
        </div>    
        <div class="modbus-conn-section-line"></div>
        <div id="modbus-addressTable" class = "modbus-table-size"></div>
        <!-- table -->
        <div class="ts-connect-table-container">
                <div class="connect-table-header">
                        <span>페이지당 행수 : </span>
                        <span class="connect-page-rows">
                            <select class="connect-table-select" ng-model="ctrl.tData.rowCount" 
                                ng-options="n as n for n in ctrl.tData.selectOpts"
                                ng-change="ctrl.tOnSelectChange()"
                            >
                            </select>
                        </span>
                    </div>
            
                    <div class="connect-table-body">
                      <table>
                        <thead>
                          <tr class="ts-table-header">
                              <th>No</th>
                              <th>이름</th>
                              <th>Address</th>
                              <th>Function Code</th>
                              <th>Quantity</th>
                              <th>Data Type</th>
                              <th>동작</th>
                          </tr>
                        </thead>
            
                        <tbody>
                          <tr class="ts-table-row" ng-repeat="item in ctrl.tData.pageNode track by $index">
                                <td>{{ (ctrl.tData.currPage * ctrl.tData.rowCount) + $index + 1 }}</td>
                                <td>{{ item.name }}</td>
                                <td>{{ item.address }}</td>
                                <td>{{ item.functioncode }}</td>
                                <td>{{ item.quantity }}</td>
                                <td>{{ item.datatype }}</td>
                                <td>
                                    <button class="btn" ng-click="ctrl.showEdit2($index)">
                                        <i class="tsi icon-ts-create"></i>
                                    </button>
                                    <button class="btn" ng-click="ctrl.removeEdit2($index)">
                                        <i class="tsi icon-ts-delete"></i>
                                    </button>
                                </td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                    <div class="connect-table-footer">
                        <div class="table-page-range">
                            <span>페이지 범위 : {{ ctrl.tData.currPage * ctrl.tData.rowCount + 1 }} - {{ (ctrl.tData.currPage * ctrl.tData.rowCount) + ctrl.tData.rowCount }} / 전체 : {{ctrl.list.length}}</span>
                        </div>
                        <div class="table-paging">
                            <button ng-click="ctrl.tPrevPaging()"><i class="tsi icon-ts-chevron_left"></i></button>
                            <button ng-click="ctrl.tSetPaging(page)" 
                              class="{{page === ctrl.tData.currPage ? 'blue' : ''}}"
                              ng-repeat="page in ctrl.tGetPagingNumberArray() track by $index">
                                <span >{{ page + 1}}</span>
                            </button>
                            <button ng-click="ctrl.tNextPaging()"><i class="tsi icon-ts-chevron_right"></i></button>
                        </div>
                    </div>
        </div>

        <!-- add view-->
        <div class = "modbus-address-add-view" ng-show = "ctrl.isAddressEditView">
            <div class = "modbus-title-address">Address List 추가</div>
            <div class="modbus-address-btn-pos">
                <button id="modbus-address-cancel-btn" className="btn" ng-click="ctrl.onShowAddressEditView()">
                    취소
                </button>
                <button id="modbus-address-add-btn" className="btn" ng-click="ctrl.editAddressList()">
                    + Address List
                </button>
            </div>    
            <div class="modbus-address-add-section-line"></div> 
            <div class="modbus-address-add-edit">
                <span class="modbus-subtitle" id="modbus-add-edit-name">이름</span>
                <div class="modbus-edit-bg" id="modbus-add-edit-name-pos">
                    <input id="modbus-edit" type="text" class="gf-form-input" ng-model="ctrl.editName" placeholder="name" >
                </div>
                <span class="modbus-subtitle" id="modbus-add-edit-address">Address</span>
                <div class="modbus-edit-bg" id="modbu-add-edit-address-pos">
                    <input id="modbus-edit" type="text" class="gf-form-input"  ng-model="ctrl.editAddress" placeholder="40001">
                </div>
                <span class="modbus-subtitle" id="modbus-add-edit-FC">FC</span>
                <div class="modbus-edit-bg" id="modbu-add-edit-FC-pos">
                    <select id="modbus-FC-combobox" ng-model="ctrl.fcSelected" ng-options="opts for opts in ctrl.modbusParams.functioncodes"></select>
                </div>
                <span class="modbus-subtitle" id="modbus-add-edit-quantity">Quantity</span>
                <div class="modbus-edit-bg" id="modbu-add-edit-quantity-pos">
                    <select id="modbus-edit" style="width:50px;height:36px" ng-model="ctrl.quantitySelected" ng-options="opts for opts in ctrl.modbusParams.quantity"></select>
                </div>
                <span class="modbus-subtitle" id="modbus-add-edit-datatype">Data Type</span>
                <div class="modbus-edit-bg" id="modbu-add-edit-datatype-pos">
                        <select id="modbus-type-combobox" ng-model="ctrl.typeSelected" ng-options="opts for opts in ctrl.modbusParams.datatypes"></select>
                </div>
            </div>
        </div>

        <!-- error message -->
        <div class="modbus-edit-box" ng-if="ctrl.connectStatus === 'red'"">            
            <div class="modbus-title-error">
                <i id="modbus-error-icon-bg" class="tsi icon-ts-warning"></i>
                <span>다음과 같은 이유로 서버에 접속 할 수 없습니다.</span>
            </div>
            <div class="modbus-conn-section-line2"></div>
            <div class="modbus-error-comment">
                <p ng-repeat="msg in ctrl.errorComment">{{msg}}</p>
            </div>
        </div>

    </div> <!--main view end-->




    <div class="button-row">
    <!-- <button type="button" class="btn btn-success" ng-click="ctrl.testCreate()">등록</button> -->
        <!--<button type="button" class="btn btn-success" ng-click="ctrl.getAddressTableData()">test</button>-->
        <!--<button type="button" class="btn btn-success" ng-click="ctrl.getTablelistData()">get-list</button>-->
        <!--<button type="button" class="btn btn-success" ng-click="ctrl.testCreate()">node-red1</button>-->
        <!--<button type="button" class="btn btn-success" ng-click="ctrl.objectTest()">OBJECT_test</button>-->
        <!--<button type="button" class="btn btn-success" ng-click="ctrl.checkParams()">input-check</button>-->
        <!-- <button type="button" class="btn btn-success" ng-click="ctrl.goPrev()">이전</button> -->
    </div>
</div> <!--page end-->